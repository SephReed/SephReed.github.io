<script type="text/javascript">
PINE.createNeedle("modal", function(modal) {

		//	
	modal.addAttArg("exitOut", "exitOnOutClick", "boolean", true);
	modal.addAttArg("fade", ["modalFade", "fade"], "id")


	modal.addInitFn(function() {
		this.currentlyShowing = false;
	})


	modal.FNS.hideModal = function() {
		var instance = this;
		if(instance.currentlyShowing == false)
			return;

		instance.currentlyShowing = false;

		instance.domNode.classList.remove("shown_overlay");

		if(instance.fade !== undefined) 
			instance.fade.classList.remove("shown_overlay");
	}

	modal.FNS.showModal = function() {
		var initMe = this.domNode;
		var fade = this.fade;

		if(this.currentlyShowing == true)
			return;

		this.currentlyShowing = true;
			//
		initMe.classList.add("shown_overlay");

		if(fade !== undefined) 
			fade.classList.add("shown_overlay");

		if(this.exitOut) {
			var mouseupFunc = function(event) {
				if(initMe == event.target || initMe.contains(event.target)) return;	
				initMe.FNS.hideModal();
				document.removeEventListener('keyup', onKeyup, false);
				document.removeEventListener('mouseup', mouseupFunc, false);
			}
			document.addEventListener('mouseup', mouseupFunc);

			var onKeyup = function(event) {
				console.log(event.key);
				if(event.key == "Escape") {
					initMe.FNS.hideModal();
					document.removeEventListener('keyup', onKeyup, false);
					document.removeEventListener('mouseup', mouseupFunc, false);
				}
			}
			document.addEventListener('keyup', onKeyup);
		}
	};
});
</script>


 

<!-- OVERLAY INLINE DEF -->

<style>
modal {
	display: none;
	position: fixed;
	z-index: 100;
	left: 50%;
	top: 50%;
	opacity: 0;
	transform: translateX(-50%) translateY(-50%);
	transition: opacity ease 2s;
}

.shown_overlay {
	display: block;
	animation: fade_in_overlay ease 0.5s forwards;
}

@keyframes fade_in_overlay {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}

fade {
	display: none;
	/*pointer-events: none;*/
	position: fixed;
	top: 0px;
	left: 0px;
	width: 100%;
	height: 100%;
	z-index: 99;
	opacity: 0;
	transition: opacity ease 2s;
}
</style>
