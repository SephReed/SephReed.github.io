<!DOCTYPE html>
<html>
<head>
	<title>Flame FX</title>

	<!-- Globals -->
	<script type="text/javascript">
		let modals; 	// modals overlay
		let fx; 			// flame fx manager
		const BOOSH_SETUP = [
			{x:74, y:170},
			{x:242, y:126},
			{x:396, y:100},
			{x:562, y:100},
			{x:718, y:126},
			{x:886, y:170},
		];
	</script>

	<!-- External Dependencies -->
	<script type="text/javascript" src="external/easyElement.js"></script>
	<!-- <script type="text/javascript" src="external/import.js"></script> -->
	<script type="text/javascript" src="external/hsvTool.js"></script>
	<script type="text/javascript" src="Class_Modals.js"></script>

	<!-- Class Heirarchy -->
	<script type="text/javascript" src="Class_FlameFX.js"></script>

	<script type="text/javascript" src="Class_PatternSelector.js"></script>
	<script type="text/javascript" src="Patterns/Class_BatchSet.js"></script>

	<script type="text/javascript" src="Class_PatternSequence.js"></script>
	<script type="text/javascript" src="Class_SequenceReader.js"></script>
	
	
	<!-- Init-->
	<script type="text/javascript">
		fx = new FlameFX(BOOSH_SETUP);
		modals = new Modals();
		sequencer = new PatternSequence();
		reader = new SequenceReader();

		document.addEventListener("DOMContentLoaded", () => {
			fx.ownDomNode(El.byTag("preview"));
			fx.ownPreviewCanvas(El.byID("preveiw_canvas"));
			fx.ownGasUsesDomNode(El.byTag("gas-use"));

			PATTERN_SELECTOR.ownDomNode(El.byTag("pattern-list"));
			sequencer.ownDomNode(El.byTag("command-list"))

			modals.ownDomNode(El.byTag("modals"));

			reader.ownDomNode(El.byTag("time-controls"));
		});

	</script>
	<style>
		:root {
			--fg: #FFF;
			--fg-dark: #EEE;
			--fg-darker: #CCC;
			--fg-darkest: #DDD;

			--bg-lightest: #666;
			--bg-lighter: #555;
			--bg-light: #444;
			--bg: #333;
			--bg-dark: #222;
			--bg-darker: #111;
			--bg-darkest: #000;

			--outset-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
			--outset-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
		}

		body, html {
			height: 100vh;
			width: 100vw;
			padding: 0px;
			margin: 0px;
			box-sizing: border-box;
			overflow: hidden;
		}

		*, *::before, *::after {
			box-sizing: inherit;
		}

		body {
			background-color: var(--bg);
			font-family: arial;
			color: var(--fg);
		}

			content {
				display: flex;
				height: 100%;
				width: 100%;
				flex-direction: column;
			}

				topbar {
					position: relative;
					z-index: 2;
					display: block;
					height: 30px;
					background-color: var(--bg-dark);
					border-bottom: 3px solid var(--bg-darker);
					box-shadow: var(--outset-2);
				}

					time-controls {
						display: block;
						position: absolute;
						left: 50%;
						transform: translate(-50%, 0%);
					}
						time-controls stop {
							background-color: #b90162;
						}

						time-controls play-pause {
							background-color: #2eae6f;
						}

							time-controls.is_playing play-pause {
								background-color: #0081ff;
							}

						time-controls .pause {
							display: none;
						}

							time-controls.is_playing .pause {
								display: inline-block;
							}

						time-controls.is_playing .play {
							display: none;
						}

						time-controls > * {
							cursor: pointer;
							display: inline-block;
							padding: 10px;
							border-radius: 100px;
							line-height: 0px;
							background-color: var(--bg-darkest);
						}
							time-controls > *:hover {
								opacity: 0.9;
							}

							time-controls > *:active {
								opacity: 0.8;
							}

							time-controls svg {
								height: 10px;
								width: 10px;
								fill: var(--fg);
							}

								

				workspace {
					position: relative;
					display: flex;
					flex-direction: row;
					flex: 1;
				}

					preview {
						position: relative;
						display: flex;
						flex-direction: column;
						flex: 1;	
					}
						preview::after {
							display: block;
							content: "";
							position: absolute;
							z-index: -1;
							top: 0px;
							height: 100%;
							width: 100%;
							background-color: var(--bg-dark);
							background-size: 50px 20px;
							background-image: url("public/grid.png");
							opacity: 0.02;
						}

						canvas {
							/*height: 100%;*/
							width: 100%;
							background-image: url("public/effigy_white_transparent.png");

							background-size: contain;
						}

						gas-use {
							display: flex;
							flex-direction: row;
							flex: 1;
							background-color: var(--bg-dark);
							text-align: center;
							padding: 10px 2px 10px 2px;
						}

							accumulator {
								display: flex;
								position: relative;
								bottom: 0px;
								flex-direction: column;
								flex: 1;
							}
								gas-meter-container {
									display: inline-block;
									position: relative;
									text-align: center;
									flex: 1;
									margin: 10px 0px;
								}

									gas-meter {
										display: inline-block;
										position: absolute;
										bottom: 0px;
										width: 20%;
										height: 50%;
										background-color: red;
										transform: translate(-50%, 0%);
									}

										/*gas-meter::after {
											display: block;
											content: "";
											position: absolute;
											top: 0px;
											left: 0px;
											width: 100%;
											height: 100%;
											border: 1px solid white;
											opacity: 0.5;
										}*/

					commands {
						position: relative;
						z-index: 1;
						display: flex;
						flex-direction: column;
						background-color: var(--bg-light);
						flex: 1;
						box-shadow: var(--outset-1);
						
					}

						options {
							display: block;
							background-color: var(--bg-lighter);
							border-bottom: solid 3px var(--bg-lightest);
						}

						command-list {
							display: block;
							flex: 1;
							overflow: scroll;
						}

		modals {
			display: block;
			position: fixed;
			top: 0px;
			left: 0px;
			right: 0px;
			bottom: 0px;	
			z-index: 2;		
			pointer-events: none;
		}

			modals > * {
				display: none;
				pointer-events: all;
				position: absolute;
				width: 90%;
				max-width: 600px;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
				background-color: red;
			}



	@media all and (max-width: 800px) {
		workspace {
			display: block;
		}

			gas-use {
				height: 40vw;
				max-height: 300px;
				flex: unset;
			}
	}

	</style>
</head>
<body>
	<content>
		<topbar>
			<time-controls>
				<stop>
					<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1 1">
						<rect width="100%" height="100%" />
					</svg>
				</stop>

				<play-pause>
					<svg class="pause" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1 1">
						<rect width="40%" height="100%" />
						<rect x="60%" width="40%" height="100%" />
					</svg>
					<svg class="play" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1 1">
						<polygon points="0 0  0 1  1 0.5" />
					</svg>
				</play-pause>

			</time-controls>
		</topbar>
		<workspace>
			<preview>
				<canvas id="preveiw_canvas" width="991" height="505"></canvas>
				<gas-use></gas-use>
			</preview>
			<commands>
				<options>
					<button onclick="modals.showOrHide('pattern-chooser')">+</button>
				</options>
				<command-list></command-list>
			</commands>
		</workspace>
	</content>
	<modals>
		<pattern-chooser>
			<h1>Add new Pattern:</h1>
			<pattern-list></pattern-list>
		</pattern-chooser>
	</modals>
</body>

<head>

</head>
</html>