<script type="text/javascript">
	var url = INCLUDED ? INCLUDED.url : window.location;
	var id = U.getHttpArg("id", url);
	var track = TRACKS.get(id);
	// console.log(track);
	var rack = track.deviceRacks[0];

	// console.log(url, id);
	// console.log(rack);

	var device_rack = El.byId("device_rack");
	var showingFront = true;

	var deviceMappings = {
		1 : "MidiToFreq",
		2 : "Oscillator",
		3 : "Knob",
		4 : "Gain",
		5 : "LinearRange"
	}

	var mustUpdateCables = true;

	var myKeyListener = function(event) {
		var deviceName = deviceMappings[event.key];

		if(deviceName != undefined) {
			mustUpdateCables = mustUpdateCables || showingFront;

			var addMe = DEVICES.new(deviceName);
			rack.addDevice(addMe);
			addMe.setEnabled(true);
		}
		else if(event.key == "Tab") {
			if(showingFront) {
				device_rack.classList.remove("show_front");
				device_rack.classList.add("show_back");

				if(mustUpdateCables) {
					rack.GUI.FNS.cableUpdatePositions();
					mustUpdateCables = false;
				}
			}
			else {
				device_rack.classList.add("show_front");
				device_rack.classList.remove("show_back");	
			}
			showingFront = !showingFront;

			event.preventDefault();
			
		}
	}

	device_rack.appendChild(rack.getGUI());
	// // console.log(device_rack, track);

	device_rack.addEventListener("mouseenter", function() {
		document.body.addEventListener("keydown", myKeyListener);
	});

	device_rack.addEventListener("mouseleave", function() {
		document.body.removeEventListener("keydown", myKeyListener);
	});
		
</script>


<div id="device_rack" class="show_front">
	<h1>{{rack.name}}</h1>
	
	<!-- <div id="device_front">
	</div>
	<div id="device_back">
	</div> -->
</div>


<style>
#device_rack {
	width: 100%;
	height: 100%;
	background: url("public/images/grid.png");
	background-size: 50px 50px;
	background-repeat: repeat;
	line-height: 0px;
}
	#device_rack > * > *{
		line-height: normal;
	}

	#device_rack h1 {
		padding-left: 20px;
		height: 50px;
	}

	.device_back, .device_front {
		height: 100%;
		width: 100%;
	}

		.device_back {
			/*background: green;*/
		}

			.device_back socket {
			}

		.show_front .device_back{
			display: none;
			/*visibility: hidden;*/
			/*pointer-events: none;*/
		}

		.show_back .device_front{
			display: none;
			/*visibility: hidden;*/
			/*pointer-events: none;*/
		}

	devicerack {
		display: block;
		height: 100%;
	}

	.show_front .cable_space {
		display: none;
	}


	rsDevice {
		width: 400px;
		height: 42px;
		display: inline-block;
		/*margin-top: -4.5px;*/
		border-style: solid;
		border-color: #222;
		background: linear-gradient(#555, #333 6px);
		border-radius: 3px;
		overflow: hidden;
		font-size: 10px;
	}
		
		rsDevice.half_size {
			width: 200px;
		}

			rsDevice.half_size rsrange{
				width: 25%;
			}


		rsDevice.quarter_size {
			width: 100px;
		}
			rsDevice.quarter_size rsrange{
				width: 50%;
			}


		rsIn, rsOut {
			display: inline-block;
			width: 20px;
			margin: 2px;
			height: 30px;
			text-align: center;
		}

			rsIn socket, rsOut socket {
				display: inline-block;
				height: 18px;
				width: 18px;
				margin: 0px 2px;
				border-radius: 20px;
			}

			socket {
				background: #000;
				border: 3px solid;
			}

			rsIn socket {
				border-color: #E9E986;
				box-shadow: inset 4px 4px 3px #333;
				border-style: double;
			}

			rsOut socket {
				/*border-style: outset;*/
				border-color: #E44A4A;
				/*position: relative;
				top: -1px;
				left: -1px;*/
				box-shadow: 2px 1px 0px #777, 4px 2px 1px #1115, inset 4px 4px 3px #333;
			}


			/*
			.valueType_freq > socket {
				border-color: #3cc83c;
			}*/

			.valueType_interval > socket, .valueType_gain > socket {
				border-color: #c8773c;
			}

			.valueType_wave > socket{
				border-color: #000;
			}

			.valueType_frequency > socket {
				border-color: #98c83c;
			}
</style>















