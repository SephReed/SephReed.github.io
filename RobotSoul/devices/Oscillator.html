<script type="text/javascript">
	var r_osc = Device("Oscillator", function(track) {
		var osc = this.audioNodes["osc"] = audioCtx.createOscillator();
		osc.frequency.value = 0; // value in hertz
		osc.type = 'sine';

		var freqKnob = RS.createDCRange(220);
		this.audioNodes["freqKnob"] = freqKnob.range;

		
		

		var intervalsGain = this.audioNodes["intervalGain"] = audioCtx.createGain();
		freqKnob.range.connect(intervalsGain);
		

		intervalsGain.gain.value = 1;
		intervalsGain.connect(osc.frequency);

		
		var gain = this.audioNodes["gain"] = audioCtx.createGain();
		osc.connect(gain);
		gain.connect(RS.Out);
		gain.gain.value = 0.25;


		// var intervalKnob = RS.createDCRange(1);
		// intervalKnob.range.connect(osc.frequency);

		var justIntonedRatios = [1, 1.066666666, 1.125, 1.2, 1.25, 1.33333333, 1.4, 1.5, 1.6, 1.6666666, 1.8, 1.875];
		this.recieveMidi = function(midiIn) {

			console.log(midiIn);
			var midiNum = midiIn.midi;
			var octaves = ~~(midiNum/12);
			var interval = justIntonedRatios[midiNum%12];
			var ratio = Math.pow(2.0, octaves - 4) * interval;

			// var freq = 75.0 * ratio;

			console.log(ratio);
			

			// this.setParam("osc", "frequency", freq);
			intervalsGain.gain.value = ratio;
		}

		gain.connect(RS.Out);
	});
</script>

<rsDevice class="quarter_size" defineRSDevice="Oscillator">
	<!-- <rsRange min="0" max="1000" node="osc" param="frequency"> -->
	<rsRange min="10" max="1000" node="freqKnob" param="gain">
		<knob></knob>
		<rsLabel>Frequency</rsLabel>
		<readout></readout>
	</rsRange>
	<rsRange min="0" max="1" node="gain" param="gain">
		<rsKnob></rsKnob>
		<rsLabel>Gain</rsLabel>
	</rsRange>
	<select node="osc" param="type">
		<option value="sine" selected>Sine</option> 
		<option value="triangle">Triangle</option>
		<option value="square">Square</option>
		<option value="sawtooth">Saw</option>
	</select>
</rsDevice>